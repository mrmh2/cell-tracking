TODO: Tidy up file layout. A lot.
